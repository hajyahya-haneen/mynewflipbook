<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flipbook RTL (26)</title>

  <style>
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      background:#f2f2f2;
      font-family: Arial, sans-serif;
    }

    /* عرض الكتاب: 600 (وعلى الشاشات الصغيرة يصير مرن) */
    #book-wrap{
      width: min(600px, 95vw);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
      box-shadow: 0 18px 55px rgba(0,0,0,.18);
    }

    /* ارتفاع مناسب لكتاب مصور (عدليه إذا بدك) */
    #book{
      width: 100%;
      height: min(420px, 80vh);
    }

    .page{ background:#fff; }

    .page img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      transform:none !important;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      direction:rtl;
    }

    button{
      border:0;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      background:#111;
      color:#fff;
      font-size:14px;
    }
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
    }

    .hint{
      font-size:13px;
      color:#444;
      direction:rtl;
      text-align:center;
      max-width:min(700px, 95vw);
      line-height:1.6;
    }
  </style>

  <!-- مهم: ترتيب التحميل -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turn.js@4/turn.min.js"></script>
</head>

<body>

  <div id="book-wrap">
    <div id="book"></div>
  </div>

  <div class="controls">
    <button id="prev">السابق</button>
    <button id="next">التالي</button>
    <button id="first">الغلاف</button>
    <button id="last">الغلاف الخلفي</button>
  </div>

  <div class="hint">
    تلميح: في وضع RTL السهم لليسار = التالي، والسهم لليمين = السابق.
  </div>

  <script>
    (function(){
      const TOTAL = 26;
      const EXT = "jpg"; // غيّريها إلى "png" إذا صورك PNG
      const $book = $("#book");

      function pad2(n){ return String(n).padStart(2, "0"); }

      function buildPages(){
        $book.empty();
        for(let i=1;i<=TOTAL;i++){
          const name = `page${pad2(i)}.${EXT}`;
          const $p = $(`<div class="page"><img src="${name}" alt="page${pad2(i)}"></div>`);
          $book.append($p);
        }
      }

      function calcSize(){
        // العرض = 600 أو أقل حسب الشاشة
        const width = Math.min(600, Math.floor(window.innerWidth * 0.95));
        // ارتفاع متوازن (يمكنك تعديله)
        const height = Math.min(420, Math.floor(window.innerHeight * 0.80));
        return {width, height};
      }

      function setButtonsEnabled(enabled){
        $("#prev, #next, #first, #last").prop("disabled", !enabled);
      }

      function initTurn(){
        const {width, height} = calcSize();

        // إذا كان turn موجود، دمّريه ثم أعيدي تهيئته
        if ($book.data("turn")) {
          $book.turn("destroy");
        }

        $book.turn({
          width,
          height,
          autoCenter: true,
          direction: "rtl",
          display: "double",
          gradients: true,
          acceleration: true,
          pages: TOTAL,

          // الغلافان مفردان
          when: {
            turning: function(){
              setButtonsEnabled(false);
            },
            turned: function(){
              setButtonsEnabled(true);
            }
          }
        });

        // ضمان أن الأزرار تشتغل بعد التهيئة
        setButtonsEnabled(true);

        // (اختياري) إبقاء الغلاف الأول ظاهر كبداية (page 1)
        $book.turn("page", 1);
      }

      // ربط أزرار بعد جاهزية الصفحة (مهم)
      $(function(){
        buildPages();
        initTurn();

        $("#next").on("click", function(){
          if(!$book.data("turn")) return;
          $book.turn("next"); // في RTL هذا “التالي” (يقلب لليسار)
        });

        $("#prev").on("click", function(){
          if(!$book.data("turn")) return;
          $book.turn("previous");
        });

        $("#first").on("click", function(){
          if(!$book.data("turn")) return;
          $book.turn("page", 1);
        });

        $("#last").on("click", function(){
          if(!$book.data("turn")) return;
          $book.turn("page", TOTAL);
        });

        // الأسهم من الكيبورد
        document.addEventListener("keydown", (e) => {
          if(!$book.data("turn")) return;
          if (e.key === "ArrowLeft")  $book.turn("next");
          if (e.key === "ArrowRight") $book.turn("previous");
        });

        // إعادة ضبط المقاس عند تغيير حجم الشاشة
        window.addEventListener("resize", () => {
          initTurn();
        });
      });
    })();
  </script>

</body>
</html>
