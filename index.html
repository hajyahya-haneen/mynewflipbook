<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arabic Flipbook (Corner Only)</title>

  <style>
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      background:#f2f2f2;
      font-family: Arial, sans-serif;
    }

    /* حجم أصغر (حسب طلبك) + متجاوب */
    #book-wrap{
      width: min(900px, 96vw);
      height: min(68vh, 560px);
      background:#fff;
      border-radius:16px;
      box-shadow:0 18px 55px rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
      touch-action: pan-y; /* يسمح بالتمرير العمودي بالموبايل */
    }

    #book{
      width:100%;
      height:100%;
    }

    /* الصفحة = إطار يمنع خروج الصورة */
    .page{
      width:100%;
      height:100%;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#fff;
    }

    /* الصورة لا تخرج من الإطار */
    .page img{
      max-width:100%;
      max-height:100%;
      width:auto;
      height:auto;
      object-fit:contain;
      display:block;
      user-select:none;
      pointer-events:none;
      -webkit-user-drag:none;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      direction:rtl;
    }

    button{
      padding:10px 14px;
      border-radius:12px;
      border:0;
      background:#111;
      color:#fff;
      cursor:pointer;
      font-size:14px;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    #status{
      font-size:13px;
      color:#b00020;
      direction:rtl;
      text-align:center;
      min-height:18px;
    }

    .hint{
      font-size:13px;
      color:#444;
      direction:rtl;
      text-align:center;
      max-width:min(900px, 95vw);
      line-height:1.6;
    }
  </style>

  <!-- مكتبة PageFlip محليًا -->
  <script src="pageflip.min.js"></script>
</head>

<body>

  <div id="book-wrap">
    <div id="book"></div>
  </div>

  <div class="controls">
    <button id="prev" type="button">السابق</button>
    <button id="next" type="button">التالي</button>
    <button id="first" type="button">الغلاف</button>
    <button id="last" type="button">الغلاف الخلفي</button>
  </div>

  <div id="status"></div>

  <div class="hint">
    التقليب **فقط من الزاوية**: اسحبي/اضغطي من أسفل اليسار (التالي) أو أسفل اليمين (السابق).
    الأزرار تعمل دائمًا.
  </div>

  <script>
    // ====== إعداداتك ======
    const TOTAL = 26;
    const PREFIX = "page"; // page01..page26
    const EXT = "jpg";     // بدّليه إلى "png" إذا صورك PNG

    const wrapEl = document.getElementById("book-wrap");
    const bookEl = document.getElementById("book");
    const statusEl = document.getElementById("status");

    let pageFlip = null;

    function pad2(n){ return String(n).padStart(2, "0"); }

    function buildPages(){
      bookEl.innerHTML = "";
      for(let i=1; i<=TOTAL; i++){
        const page = document.createElement("div");
        page.className = "page";
        page.innerHTML = `<img src="${PREFIX}${pad2(i)}.${EXT}" alt="">`;
        bookEl.appendChild(page);
      }
    }

    // مقاس صفحة واحدة (ليس الكتاب كامل)
    // على الكمبيوتر: كتاب = صفحتين => صفحة = تقريباً نصف عرض الحاوية
    // على الهاتف: سيصبح تلقائياً أصغر
    function computePageSize(){
      const w = wrapEl.clientWidth;
      const h = wrapEl.clientHeight;

      const pageWidth  = Math.max(280, Math.min(460, Math.floor(w / 2)));
      const pageHeight = Math.max(320, Math.min(560, Math.floor(h)));

      return { pageWidth, pageHeight };
    }

    // شرط "فقط من الزاوية": نسمح ببدء التقليب فقط إذا كان الضغط داخل مربع زاوية
    function installCornerOnlyGate(){
      const CORNER = 120; // مساحة الزاوية المسموح منها (px)

      // نزيل أي مستمع قديم لتجنب التكرار
      wrapEl.onpointerdown = null;

      wrapEl.addEventListener("pointerdown", function(e){
        // لا نكسر الأزرار (هي خارج wrap أساساً)، هذا فقط داخل الكتاب
        const rect = wrapEl.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const inBottom = (y >= rect.height - CORNER);
        const inLeftCorner  = inBottom && (x <= CORNER);
        const inRightCorner = inBottom && (x >= rect.width - CORNER);

        // اسمح فقط من أسفل اليسار/أسفل اليمين
        if (!(inLeftCorner || inRightCorner)) {
          e.preventDefault();
          e.stopImmediatePropagation();
          return false;
        }
      }, true); // capture=true مهم حتى نمنع البداية من الوسط قبل أن تلتقطها المكتبة
    }

    function init(){
      // تحقق المكتبة
      if (!window.St || !St.PageFlip){
        statusEl.textContent = "مكتبة PageFlip غير محمّلة. تأكدي أن pageflip.min.js موجود بجانب index.html واسمه صحيح.";
        return;
      }
      statusEl.textContent = "";

      buildPages();

      const { pageWidth, pageHeight } = computePageSize();

      // إذا فيه تهيئة قديمة، دمّريها
      if (pageFlip && typeof pageFlip.destroy === "function") {
        try { pageFlip.destroy(); } catch(_) {}
      }
      pageFlip = null;

      // تهيئة PageFlip
      pageFlip = new St.PageFlip(bookEl, {
        width: pageWidth,
        height: pageHeight,
        size: "stretch",

        minWidth: 280,
        maxWidth: 900,
        minHeight: 320,
        maxHeight: 700,

        showCover: true,
        mobileScrollSupport: true,

        useMouseEvents: true,
        swipeDistance: 30,
        flippingTime: 700,
        maxShadowOpacity: 0.35,

        // نسمح بالنقر، لكن سنمنع البداية من الوسط عبر Gate
        disableFlipByClick: false
      });

      // تحميل الصفحات من HTML
      pageFlip.loadFromHTML(bookEl.querySelectorAll(".page"));

      // RTL بصري: نقلب الحاوية أفقياً ثم نعيد قلب الصور حتى لا تنعكس الكتابة
      bookEl.style.transform = "scaleX(-1)";
      bookEl.style.transformOrigin = "center";
      bookEl.querySelectorAll("img").forEach(img => {
        img.style.transform = "scaleX(-1)";
        img.style.transformOrigin = "center";
      });

      // ربط الأزرار (تأكد أنها تعمل)
      document.getElementById("next").onclick  = () => pageFlip.flipNext();
      document.getElementById("prev").onclick  = () => pageFlip.flipPrev();
      document.getElementById("first").onclick = () => pageFlip.turnToPage(0);
      document.getElementById("last").onclick  = () => pageFlip.turnToPage(TOTAL - 1);

      // تفعيل شرط “فقط من الزاوية”
      installCornerOnlyGate();
    }

    // تشغيل أول مرة
    window.addEventListener("load", init);

    // إعادة تهيئة عند تغيير حجم الشاشة
    let timer = null;
    window.addEventListener("resize", () => {
      clearTimeout(timer);
      timer = setTimeout(init, 180);
    });
  </script>

</body>
</html>
